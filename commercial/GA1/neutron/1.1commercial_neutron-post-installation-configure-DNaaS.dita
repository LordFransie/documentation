<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic19557">
    <title>HP Helion OpenStack(R) 1.1: DNSaaS Configuration (Optional)</title>
    <prolog>
        <metadata>
            <othermeta name="layout" content="default"/>
            <othermeta name="product-version" content="HP Helion OpenStack(R)"/>
            <othermeta name="product-version" content="HP Helion OpenStack(R) 1.0"/>
            <othermeta name="product-version" content="HP Helion OpenStack(R) 1.0.1"/>
            <othermeta name="product-version" content="HP Helion OpenStack(R) 1.1"/>
            <othermeta name="role" content="Network Administrator"/>
            <othermeta name="role" content="Network Architect"/>
            <othermeta name="role" content="Vikas Deolaliker, Paul Kevin"/>
            <othermeta name="product-version1" content="HP Helion OpenStack(R)"/>
            <othermeta name="product-version2" content="HP Helion OpenStack(R) 1.0"/>
            <othermeta name="product-version3" content="HP Helion OpenStack(R) 1.0.1"/>
            <othermeta name="product-version4" content="HP Helion OpenStack(R) 1.1"/>
        </metadata>
    </prolog>
    <body><section id="top" />
        <p><!--PUBLISHED--><!--./commercial/GA1/neutron/1.1commercial_neutron-post-installation-configure-network.md--><!--permalink: /helion/openstack/1.1/services/neutron/post/installation/configure-dnsaas/--></p>
        <p>Our managed DNS service, based on the OpenStack Designate project, is engineered to help
            you create, publish, and manage your DNS zones and records securely and efficiently to
            either a public or private DNS server network.</p>
        <p>It is important to read through this page before starting your installation as it
            explains how to install and configure DNS as a service (DNSaaS) for HP Helion
            OpenStack.</p>
        <p><b>Caution</b>: Before migrating to DNSaaS 1.01, you <b><i>must</i></b> first <xref
                href="../../../CarrierGrade/AdminGuideNew/Backup/carrier-grade-admin-wr-backup-cinder.dita"
                >uninstall</xref> DNSaaS 1.0. Do <b>not</b> attempt to install version 1.01 over the
            previous version. </p>
        <section id="dnaas-config">
            <title>DNSaaS Configuration</title>
            <p> Our managed DNS service, based on the OpenStack Designate project, is engineered to
                help you create, publish, and manage your DNS zones and records securely and
                efficiently to either a public or private DNS server network.</p>
            <p>It is important to read through this page before starting your installation as it
                explains how to install and configure DNS as a service (DNSaaS) for HP Helion
                OpenStack.</p>
            <p><b>Note</b>: These installation instructions assume that the associated project
                currently contains no instances (VMs). If this is not the case, see the instructions
                    for<xref
                    href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#increasequotas-jumplink-span"
                    format="html" scope="external">increasing quotas</xref> to ensure you have
                enough space before you begin.</p>
            <p><b>Caution</b>: DNSaaS 1.1 will <b>only</b> install on Helion OpenStack 1.1 Do
                    <b>not</b>attempt to install DNSaaS on any previous versions.</p>
            <ul id="ul_cy1_jm4_ks">
                <li><xref href="#topic19557/preq" format="dita"/></li>
                <li><xref href="#topic19557/Creating-preq" format="dita"/><ul id="ul_ow5_k44_ks">
                        <li><xref href="#topic19557/target-credentials" format="dita"/></li>
                    </ul><ul id="ul_o5c_fm4_ks">
                        <li><xref href="#topic19557/service-credentials" format="dita"/></li>
                    </ul></li>
            </ul>
            <ul id="ul_tw1_n44_ks">
                <li><xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#publication-jumplink-span"
                        format="html" scope="external">Sherpa CSU Publication and Booting the
                        Installer VM</xref></li>
                <li><xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#configure-jumplink-span"
                        format="html" scope="external">Installing and Configuring DNSaaS</xref></li>
                <li><xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#configovercloud-jumplink-span"
                        format="html" scope="external">Configure the Overcloud Load Balancer for
                        DNSaaS</xref></li>
                <li><xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#keyreg-jumplink-span"
                        format="html" scope="external">Registering the Service with
                    Keystone</xref></li>
                <li><xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#uninstall-jumplink-span"
                        format="html" scope="external">Uninstalling DNaaS</xref></li>
                <li><xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#moreinfo-jumplink-span"
                        format="html" scope="external">More Information</xref></li>
            </ul>
        </section>
        <section id="preq">
            <title><b>Prerequisites</b></title>
            <p><b>Caution</b>: DNSaaS 1.1 will <b>only</b> install on Helion OpenStack 1.1 Do
                    <b>not</b>attempt to install DNSaaS on any previous versions.</p>
            <p><b>Note</b>: These installation instructions assume that the associated project
                currently contains no instances (VMs). If this is not the case, see the instructions
                    for<xref
                    href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#increasequotas-jumplink-span"
                    format="html" scope="external">increasing quotas</xref> to ensure you have
                enough space before you begin.<ul id="ul_tcg_yj4_ks">
                    <li>HP Helion OpenStack is successfully installed</li>
                    <li>Download <xref
                            href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#publication-jumplink-span"
                            format="html" scope="external">DNSaaS Installer Image</xref>
                    </li>
                    <li>Obtain <xref
                            href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#target-cred-jumplink-span"
                            format="html" scope="external">Target Credentials</xref>: credentials of
                        the user+tenant where the service is to be deployed.<ul id="ul_sch_2k4_ks">
                            <li>This user should have the <b>admin</b> and <b>_member_</b>
                                roles</li>
                            <li>Username</li>
                        </ul><ul id="ul_yjs_1k4_ks">
                            <li>Password</li>
                            <li>Tenant/Project Name</li>
                        </ul></li>
                </ul></p>
            <ul id="ul_gmv_hk4_ks">
                <li>Obtain <xref
                        href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#service-cred-jumplink-span"
                        format="html" scope="external">Service Credentials</xref>: credentials for
                    the user+tenant used to validate end user tokens.<ul id="ul_lzd_lk4_ks">
                        <li>This user should be in the <b>service</b> tenant, have the <b>admin</b>
                                and<b>_member_</b> roles, and be called <b>designate</b>.</li>
                        <li>Username</li>
                        <li>Password</li>
                        <li>Tenant/Project Name</li>
                    </ul></li>
                <li>A generated SSH Key for accessing the Service VMs</li>
                <li>A chosen backend driver and its prerequisites:<ul id="ul_dwr_vk4_ks">
                        <li>PowerDNS (self hosted)<p>A domain name for the nameservers ("Namesever
                                FQDNs"). For example, if your nameservers are to be named
                                    <i>ns1.mycompany.com</i>, you will need the <i>mycompany.com</i>
                                domain.</p></li>
                        <li>Microsoft DNS (self-hosted)<ul id="ul_e5g_gl4_ks">
                                <li>At least one Microsoft DNS server installed and configured</li>
                                <li>Knowledge of the FQDNs for all MS DNS servers to be used
                                    ("Namesever FQDNs")</li>
                            </ul></li>
                        <li>DynECT (3rd Party)<ul id="ul_dcl_nl4_ks">
                                <li>An active service contract with DynECT</li>
                                <li>Knowledge of the FQDNs for all DynECT nameservers allocated to
                                    your account ("Namsever FQDNs")<ul id="ul_fpl_5l4_ks">
                                        <li>ns1.p13.dynect.net.</li>
                                        <li>ns2.p13.dynect.net.</li>
                                        <li>ns3.p13.dynect.net.</li>
                                        <li>ns4.p13.dynect.net.</li>
                                    </ul></li>
                                <li>API credentials for DynECT<ul id="ul_irq_ql4_ks">
                                        <li>Customer Name</li>
                                        <li>Username</li>
                                        <li>Password</li>
                                    </ul></li>
                            </ul></li>
                        <li>Akamai (3rd Party)<ul id="ul_nt5_xk4_ks">
                                <li>An active service contract with Akamai</li>
                                <li>Knowledge of the FQDNs for all Akamai nameservers allocated to
                                    your account ("Namesever FQDNs")</li>
                                <li>API credentials for Akamai<ul id="ul_qxs_cm4_ks">
                                        <li>Username</li>
                                        <li>Password</li>
                                    </ul></li>
                            </ul></li>
                    </ul></li>
            </ul>
        </section>
        <p><b>Important:</b> The DNS install will not work if the associated project has existing
            instances (VMs). If the project has existing VMs, the admin must increase the quota
            levels to the following for that project before attempting to install DNS.<ul
                id="ul_s4x_lm4_ks">
                <li>instances:16</li>
                <li>RAM: 44 GB</li>
                <li>Volumes: 6</li>
                <li>Storage:240</li>
            </ul></p>
        <section id="Creating-preq">
            <title><b>Creating Prerequisite Credentials</b></title></section>
            <p>You must create both <b>target</b> and <b>service</b> credentials.</p>
       
        <section id="target-credentials">
            <title><b>Target Credentials</b></title>
            <p>Target credentials are the credentials of the user+tenant where the service is to be
                deployed. Target credentials include a <b>tenant</b> and a <b>username</b>. Service
                credentials can only be created after the Target credentials have been successfully
                    created.<ul id="ul_tdw_1n4_ks">
                    <li>Create
                        tenant<codeblock>keystone tenant-create --name dnsaas --description "DNSaaS Service" </codeblock></li>
                    <li>Create
                        username<codeblock>keystone user-create --name dnsaas --tenant dnsaas --email dnsaas@example.com --pass password</codeblock></li>
                    <li>Add role (this role is added for
                        user)<codeblock>$ keystone user-role-add --user dnsaas --tenant dnsaas --role admin</codeblock></li>
                </ul></p>
        </section>
        <section id="service-credentials">
            <title><b>Service Credentials</b></title>
            <p>Service Credentials are credentials for the user+tenant used to validate end user
                tokens. Service credentials can only be created after the Target credentials have
                been successfully created. This user should be in the <b>service</b> tenant, have
                    the<b>admin</b> and <b>_member_</b> roles, and be named <b>designate</b>.<ul
                    id="ul_z33_nn4_ks">
                    <li>Create service
                        credentials<codeblock>keystone user-create --name designate --tenant service --email designate@example.com --pass password</codeblock></li>
                    <li>Add admin role to service user
                        command<codeblock>keystone user-role-add --user designate --tenant service --role admin</codeblock></li>
                </ul></p>
        </section>
        <section id="sherpa">
            <title><b>Sherpa CSU Publication and Booting the Installer VM</b></title>
            <p>Before proceeding with the DNaaS installation, ensure that you have met all the
                prerequisites, which includes gathering the required information, creating the
                necessary users/projects and ensuring the users/projects have the appropriate roles.
                Failure to do so will result in a failed install.</p>
        </section>
        <section id="publish-csu">
            <title><b>Publish CSU contents</b></title>
            <ol id="ol_jkv_vn4_ks">
                <li>Log in to the Horizon dashboard using <b>Target Credentials</b>.</li>
                <li>Click <b>Admin</b> Tab in the left panel.<p>The tab displays an option in the
                        left panel.</p></li>
                <li> Click <b>Updates and Extensions</b> and then select <b>Updates and
                        Extensions</b>to open the Updates and Extensions page.</li>
                <li>Click <b>Configure</b> in the top-right corner of the page to display the
                    Configure dialog box.</li>
                <li>Log in with Helion Content Delivery Network credentials. If you do not yet have
                    login credentials for the Helion Delivery Network, create an account.<ol
                        id="ol_hy4_dq4_ks">
                        <li>On the Horizon undercloud dashboard, click the <b>Admin</b> tab in the
                            left panel</li>
                        <li>Click <b>Updates and Extensions</b> and then select <b>Updates and
                                Extensions</b> to open the Updates and Extensions page.</li>
                        <li>Click <b>Configure</b> in the top-right corner of the page to display
                            the Configure dialog box.</li>
                        <li>Click <b>Sign up Now</b> below the description in the Configure dialog
                            box.The page navigates to the HP Helion Product Catalog. Then, do the
                            following:</li>
                        <li>Click <b>Sign In</b> in the top of the page to open the HP Web ID dialog
                            box.</li>
                        <li>Click <b>Sign Up for Web ID</b> to create log-in credentials. The HP WEB
                            ID dialog box is displayed.</li>
                        <li> Enter the required details.</li>
                        <li>Select the check box next to <b>I agree to the Terms of Use</b> to
                            accept the terms and conditions.</li>
                        <li>Click <b>Submit</b>.The credentials are authenticated and the account is
                            created. Once you register on the HP Helion Product Catalog, you are
                            required to configure your credentials.</li>
                    </ol></li>
                <li>Click <b>Download</b> against the package that you want to download on your
                    local system from a list of .csu file.</li>
                <li>Select the appropriate file (for example: <b>dns.csu</b>) from the list and
                        click<b>Publish</b>.</li>
                <li>Click <b>Publish</b> to install the package.</li>
            </ol>
        </section>
        <section id="boot-installer">
            <title><b>Boot the installer VM</b></title>
            <ol id="ol_l1d_nq4_ks">
                <li>Log in to the Horizon dashboard using <b>Target Credentials</b>.</li>
                <li>Click <b>Project</b>. The tab displays an option in the left panel.</li>
                <li>Click <b>Compute</b> and then select <b>Images</b> to open the Image page.</li>
                <li>Select the image file from the list and click <b>Launch</b>. For example: select
                        <b>dnsaas-installer_1.1.0.30</b> to launch this image. <p>A Launch Instance
                        dialog box displays with five tabs: Details Tab, Access &amp; Security Tab,
                        Networking Tab, Post-Creation Tab and Advance Options. By default, Details
                        is the active tab.</p></li>
                <li>On the Details Tab, do the following:<ol id="ol_hkx_njp_ks">
                        <li>In the <b>Instance Name</b> (Virtual Machine (VM))box enter the name of
                            the instance. For example :<b>dnsaas-installer</b>.</li>
                        <li>.From the <b>Flavor</b> drop-down list and select the flavor. For
                                example:<b>m1.small</b></li>
                    </ol></li>
                <li>On the <b>Access and Security</b> Tab, do the following:<ol id="ol_oyb_qjp_ks">
                        <li>From the <b>Keypair</b> drop-down list, select an appropriate SSH
                            keypair.</li>
                    </ol></li>
                <li>On the <b>Networking</b> Tab, select the <b>default-net</b> network, if it is
                    not populated automatically.</li>
                <li>Click <b>Launch</b> to launch the Instance. You are taken to the Instances page
                    with the progress bar displaying the completion progress.</li>
                <li>Select the launched instance in the Instance table.</li>
                <li>Generate a floating IP address to use:<ol id="ol_xm2_5jp_ks">
                        <li>Open a shell.</li>
                        <li>Download the <xref
                                href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#target-cred-jumplink-span"
                                format="html" scope="external">target credentials</xref> in an RC
                            file, for example using Horizon.</li>
                        <li>Source the
                            credentials.<codeblock>source &lt;filename&gt;openrc.sh</codeblock></li>
                        <li>Run the <codeph>nova floating-ip-create</codeph> command to return a
                            floating IP address.</li>
                        <li>Run the <codeph>nova floating-ip-associate dnsaas-installer </codeph>
                            <codeph>&lt;floating-ip</codeph> &gt; command using the IP address you
                            obtained in the previouis step.</li>
                    </ol></li>
                <li>Perform the following steps in the Manage Floating IP Associations:<ol
                        id="ol_kx4_lkp_ks">
                        <li>From the <b>IP Address</b> drop-down list, select the Floating IP
                            address. Ensure that you remember the selected IP address.</li>
                        <li>From the <b>Port to be associated</b> drop-down list, select the
                            port.</li>
                        <li>Click <b>Associate</b>.</li>
                    </ol></li>
                <li>Click <b>Access and Security</b>. Access &amp; Security page is displayed.</li>
                <li>Select the appropriate security group from the list and click <b>Manage
                        Rules</b>. For example: select <b>default</b> as a security group. The page
                    navigates to Manage Security Group Rules: &lt;name of security&gt; page.</li>
                <li>Click <b>Add Rule</b>. Add Rule dialog box is displayed.</li>
                <li>In the <b>Port</b> box, enter the port value as <b>22</b>.</li>
                <li>(Optionally) Restrict the CIDR from which SSH connections should be
                    allowed.</li>
                <li>Click <b>Add</b>. The rule is added for the instance.</li>
            </ol>
        </section>
        <section>
            <title><b>Installing and configuring DNSaaS</b></title>
            <p><b>IMPORTANT</b>: During DNSaaS installation, non-deterministic failures within the
                infrastructure layer may cause the install to fail. If this occurs, DNSaaS
                installation should be retried up to two times.<ol id="ol_qzk_wkp_ks">
                    <li>SSH to install
                                VM.<codeblock><codeph>ssh -i samplekey.pem debian@&lt;Floating IP Address associated with the DNS Installer VM></codeph></codeblock><p><b>Note</b>:
                            Before you begin the installation, you must create a configuration file.
                            You can do this by modifying the sample configuration file included with
                            the DNSaaS installer files.</p></li>
                    <li>Create the SSH Public Key which is used by the Service VMs.<p>It is
                            recommended to use the same SSH key which was used to boot the installer
                            VM. If you choose to use a different SSH key, please ensure you retain
                            both SSH private keys for future use.</p></li>
                    <li>Copy the SSH Public
                        Key.<codeblock><codeph>cp .ssh/authorized_keys id_rsa.pub</codeph></codeblock></li>
                    <li>Copy the sample configuration file to your home
                        directory:<codeblock><codeph>cp /etc/dnsaas-installer/dnsaas-installer.conf.sample ~/dnsaas-installer.conf</codeph></codeblock></li>
                    <li>Edit your copy of the configuration file with the required
                                changes:<codeblock><codeph>nano dnsaas-installer.conf</codeph></codeblock><p><b>A.
                                DEFAULT section:</b><ul id="ul_olc_nlp_ks">
                                <li><codeph>target_project_name</codeph>- Project name where the
                                    service is installedn</li>
                                <li><codeph>target_username</codeph>- Username used to deploy and
                                    run the service</li>
                                <li><codeph>target_region_name </codeph>- Region name to deploy the
                                    service </li>
                                <li><codeph>undercloud_vip </codeph>- This is the IP used to connect
                                    to the undercloud. This should be output by the Helion EE
                                    installer</li>
                                <li><codeph>overcloud_vip</codeph>- This is the IP used to connect
                                    to the undercloud. This should be output by the Helion EE
                                    installer</li>
                            </ul></p></li>
                </ol></p>
        </section>
        <section id="designate-section">
            <p>B. Designate section:<ul id="ul_qv5_kmp_ks">
                    <li><codeph>ntp_servers</codeph>-List of NTP servers to use in the DNSaaS
                        VMs.</li>
                    <li><codeph>ssh_public_key</codeph>-The SSH public key to be installed on the
                        instances for management access.</li>
                    <li><codeph>ca_certificate</codeph>-The CA Certificate used by the Overcloud API
                        endpoints. This is available on the overcloud control nodes This should
                        point to a CA cert file on disk.</li>
                    <li><codeph>database_root_password</codeph>-Password for the database root user.
                        This should be over 16 characters.</li>
                    <li><codeph>database_designate_password</codeph>-Password for the database
                        designate user. This should be over 16 characters.</li>
                    <li><codeph>database_powerdns_password</codeph>-Password for the database
                        powerdns user. This should be over 16 characters.</li>
                    <li><codeph>messaging_root_password</codeph>-Password for the messaging root
                        user. This should be over 16 characters.</li>
                    <li><codeph>messaging_designate_password </codeph>-Password for the messaging
                        designate user. This should be over 16 characters.</li>
                    <li><codeph>service_project</codeph>-Project name for a user with permission to
                        validate Keystone tokens.</li>
                    <li><codeph>service_user</codeph>-Username for a user with permission to
                        validate Keystone tokens.</li>
                    <li><codeph>service_password</codeph>-Password for a user with permission to
                        validate Keystone tokens</li>
                    <li><codeph>ephemeralca_password</codeph>-EphemeralCA Password. This must match
                        the eCA password value from the overcloud passwords file. This should be
                        output by the Helion EE installer</li>
                    <li><codeph>backend_driver</codeph>-Backend driver to use (powerdns, dynect,
                        akamai)</li>
                    <li><codeph>enable_beaver</codeph>-Enable Central Logging Support</li>
                    <li><codeph>beaver_rabbit_password</codeph>-Beaver RabbitMQ Connection Password
                        This must match the RabbitMQ password value from the undercloud passwords
                        file. This should be output by the Helion EE installer<p><b>C</b>. If you
                            select MSDNS (Microsoft DNS Server) you must set the following options
                            in the designate section:</p></li>
                    <li><codeph>msdns_servers</codeph>-A comma separated list of the Microsoft DNS
                        servers short hostnames.</li>
                    <li><codeph>msdns_also_notify</codeph>-- List of IP addresses for name servers
                        to notify when a zone is changed (Comma separated). These should be the IP
                        addresses of the Microsoft DNS Servers.</li>
                    <li><codeph>messaging_access_cidr </codeph>-- A CIDR to allow inbound access
                        from the Microsoft DNS servers.</li>
                    <li><codeph>nameserver_allow_axfr_ips</codeph>- CIDRs that are allow do zone
                        transfers from the PowerDNS servers (Required for use with akamai, DynECT
                        and Microsoft) - list of IPs and / or CIDRs. (Comma separated). This should
                        be set to allow connections from the Microsoft DNS Servers.<p><b>D</b>. If
                            you select Akamai you must set the following options in the designate
                            section:</p></li>
                    <li><codeph>akamai_username</codeph>-The username that was set up as part of
                        your Akamai signup.</li>
                    <li><codeph>akamai_password</codeph>-The password that was set up as part of
                        your Akamai signup.</li>
                    <li><codeph>akamai_also_notify</codeph>-List of IP addresses for name servers to
                        notify when a zone is changed (Comma separated). These should be the IP
                        addresses provided by Akamai during signup</li>
                    <li><codeph>nameserver_allow_axfr_ips</codeph>- CIDRs that are allow do zone
                        transfers from the PowerDNS servers (Required for use with akamai, DynECT
                        and Microsoft) - list of IPs and / or CIDRs. (Comma separated). This should
                        be set to allow connections from the Akamai Zone Transfer Agents (provided
                        during Akamai sign up)<p><b>E</b>. If you select DynECT you must set the
                            following options in the designate section:</p></li>
                    <li><codeph>dynect_customer_name</codeph>-nameserver_allow_axfr_ips</li>
                    <li><codeph>dynect_username</codeph>-Username provided by DynECT signup.</li>
                    <li><codeph>dynect_password </codeph>-Password provided by DynECT signup.</li>
                    <li><codeph>dynect_also_notify</codeph>-List of hostnames for name servers to
                        notify when a zone is changed (Comma separated). These should be the IP
                        addresses provided by DynECT during signup.</li>
                    <li><codeph>nameserver_allow_axfr_ips</codeph>-CIDRs that are allow do zone
                        transfers from the PowerDNS servers (Required for use with akamai, DynECT
                        and Microsoft) - list of IPs and / or CIDRs. (Comma separated). This should
                        be set to allow connections from the Akamai Zone Transfer Agents (provided
                        during Akamai sign up).<p><b>Run the installer validation and
                            installaer</b></p><ol id="ol_dwj_qpp_ks">
                            <li>Run the installer validation command to verify the configuration
                                file<codeblock><codeph>$ dnsaas-installer --target-password &lt;Target User Password> validate</codeph></codeblock></li>
                            <li>After you validate the configuration file, run the DNSaaS
                                installer:<codeblock><codeph> $ dnsaas-installer --target-password &lt;Target User Password> install</codeph></codeblock></li>
                        </ol></li>
                </ul></p>
        </section>
        <section id="configure-overcloud-load-balancer">
            <title><b>Configure the Overcloud Load Balancer for DNSaaS</b></title>
            <p>You must configure HAProxy before you configure the overcloud Load Balance for
                DNaaS.</p>
            <p>To configure HAProxy use the following
                command:<codeblock><codeph>$ dnsaas-installer --target-password &lt;Target User Password> haproxy</codeph></codeblock></p>
            <p>The HA Proxy configuration file will be displayed as the sample
                below:<codeblock>2014-09-17 23:31:05.670       INFO HAProxy configuration
### START HAPROXY CONFIG
listen designate
  bind 0.0.0.0:9001
  mode tcp
  balance source
  option tcpka
  option tcplog
  option httpchk GET /

  server 10.22.171.32 10.22.171.32 check inter 2000 rise 2 fall 5
  server 10.22.171.22 10.22.171.22 check inter 2000 rise 2 fall 5
  server 10.22.171.21 10.22.171.21 check inter 2000 rise 2 fall 5
### END HAPROXY CONFIG</codeblock></p>
            <p>After the configuration of HAProxy, SSH to all three overcloud controllers.</p>
            <p>Perform the following steps on each controller node:<ol id="ol_kyg_fqp_ks">
                    <li>SSH overcloud and
                        sudo:<codeblock><codeph>ssh heat-admin@&lt;IP address of overcloud>
sudo -i</codeph></codeblock></li>
                    <li>nano <codeph>paas.cfg </codeph>to edit the configuration
                        file<codeblock><codeph>nano /etc/haproxy/manual/paas.cfg</codeph></codeblock></li>
                    <li>Paste the HA Proxy configuration file, which is generated in step 1, at the
                        end of the <codeph>paas.cfg</codeph> file</li>
                    <li>Save the  <codeph>paas.cfg</codeph>
                        file.<codeblock><codeph> CTRL+X</codeph></codeblock></li>
                    <li>Reload HA
                        Proxy<codeblock><codeph>service haproxy reload </codeph></codeblock></li>
                    <li>Open the Designate API port in the firewall and run the following
                            commands<ol id="ol_qmq_qqp_ks">
                            <li>Run<codeblock><codeph>iptables -I INPUT 1 -p tcp -m tcp --dport 9001 -j ACCEPT</codeph></codeblock></li>
                            <li>Run<codeblock><codeph>iptables-save > /etc/iptables/iptables </codeph></codeblock></li>
                        </ol></li>
                    <li>If you are using MSDNS (Microsoft DNS Server) you must install an agent on
                        each the Microsoft DNS server. These steps must be performed on each
                        Microsoft DNS server to install the agent:<p>The installer for the agent is
                            in
                            /opt/stack/designate-msdnsagent/OpenStack.Designate.MicrosoftDNS.Installer.exeon
                            the DNSaaS Installer VM; this is the one that you booted to install
                            DNSaaS. Download this file and distribute it to all the target Microsoft
                            DNS Server</p><ol id="ol_hjk_pqp_ks">
                            <li> Run the install.</li>
                            <li>Open the DNS Configuration (in <b>Start &gt; Programs &gt; HP &gt;
                                    DNS Configuration</b>) and select <b>Run as
                                Administrator</b>.k</li>
                            <li>In the window that displays:<ul id="ul_oqn_jrp_ks">
                                    <li><b>RabbitMQ Hosts</b> - Enter the IP address for the
                                        Messaging Outputs, each entry on a line, with no
                                        commas.</li>
                                    <li><b>RabbitMQ Port</b> - Leave the default.</li>
                                    <li><b>RabbitMQ User</b> - Leave as the default (designate)</li>
                                    <li><codeph>RabbitMQ Password / Confirm Password</codeph> -
                                        Enter the value of the <codeph>
                                            messaging_designate_password</codeph> value in the
                                            <codeph>dnsaas-installer.conf</codeph> .</li>
                                    <li><b>Master DNS Servers</b> - Enter the IP addresses of the
                                        Nameserver Outputs, each entry on a line, with no
                                        commas.</li>
                                    <li><b>Agent Name</b> - Enter one of the values set in
                                            <codeph>msdns_servers</codeph>config value, and unique
                                        per MS DNS server</li>
                                    <li><codeph> CA Cert</codeph> - Enter the value of the
                                        ephemeral-ca.crt file on the seed cloud host.</li>
                                </ul></li>
                            <li>Click <b>Validate</b>.</li>
                            <li>Click <b>Save</b></li>
                            <li>Go to <b>Start &gt; Programs &gt; Administrative Tools &gt;
                                    Services</b>.</li>
                            <li>.Restart the <b>OpenStack.Designate.MicrosoftDNS' Service</b>.</li>
                        </ol></li>
                </ol></p>
        </section>
        <section><b>Registering the service with Keystone</b><p>You can register the DNS service and
                endpoint as a user or an admin.</p><p>You do not have to immediately register the
                DNS service in Keystone; however, if you choose to register the DNS service and
                endpoint execute the following
                command:</p><p>User:<codeblock><codeph>dnsaas-installer --target-password &lt;Target User Password> keystone-registration</codeph></codeblock></p></section>
        <section id ="initial-service">
            <title><b>Initial Service Configuration</b></title>
            <p>You must perform an initial configuration step to communicate the names of the
                servers that serve DNS to Designate. Please ensure you have a valid set of admin
                credentials in the standard OS_* environment variables before proceeding.</p>
            <p>For the "Nameserver FQDNs" gathered during the <xref
                    href="http://docs.hpcloud.com/helion/openstack/1.1/install/dnsaas/#preq-jumplink-span"
                    format="html" scope="external">prerequisites</xref> step, issue a
                    <codeph>server-create</codeph> command for each name to add the
                server:<codeblock><codeph>$ designate server-create --name ns1.example.com.</codeph></codeblock></p>
            <p>For example
                :<codeblock><codeph>designate server-create --name ns1.p13.dynect.net.</codeph></codeblock></p>
        </section>
        <section id="post-install">
            <title><b>Post-install cleanup</b></title>
            <p>The installer VM is no longer required. Archive the configuration file and the SSH
                public and private keys used and optionally delete the dnsaas-installer
                instance.</p>
        </section>
        <section id="unistall-dnaas">
            <title><b>Uninstall DNaaS</b></title>
            <p>To uninstall the DNaaS:<ol id="ol_w3d_ctp_ks">
                    <li>Enter the following command to list the DNaaS Stack
                        ID:<codeblock><codeph>$ heat stack-list</codeph></codeblock></li>
                    <li>Using python-heatclient and the Target Credentials supplied to the
                        installer, verify the DNSaaS Stack ID and delete
                        it.<codeblock><codeph>$ heat stack-delete &lt;stack ID></codeph></codeblock></li>
                </ol></p>
            <p><b>Note</b>: Installer VM can also be deleted, if it is not deleted already.</p>
            <p>The Keystone service and endpoints will not be deleted, if you want to remove these
                services, please refer to the <xref
                    href="http://docs.openstack.org/developer/keystone/" format="html"
                    scope="external">Keystone documentation</xref></p>
        </section>
        <section>
            <title><b>Troubleshooting: Increasing Quotas</b></title>
            <p>If the associated project already has existing instances (VMs), the DNSaaS
                installation will not have sufficient room to complete. An admin must increase the
                quota levels to allow sufficient room before installation.<ol id="ol_hqz_ktp_ks">
                    <li>Log in to the Horizon console.</li>
                    <li>In the <b>Project</b> panel, click <b>Identity</b> and then click
                            <b>Projects</b>.</li>
                    <li>Find the project in the list and click <b>Modify Users</b>.</li>
                    <li>Click <b>Edit Project</b> and then click the <b>Quota</b> tab.</li>
                    <li>Increase the following quotas to create sufficient room:.<ul
                            id="ul_tnx_vtp_ks">
                            <li>Instances: Add 16</li>
                            <li>RAM: Add 44 GB</li>
                            <li>Volumes: Add 6</li>
                            <li>Storage: Add 240 GB</li>
                        </ul></li>
                    <li>Click <b>Save</b>.</li>
                </ol></p>
        </section>
        <section>
            <title><b>More Information</b></title>
            <p>For more information, see:<ul id="ul_w15_f5p_ks">
                    <li><xref href="https://wiki.openstack.org/wiki/Designate" format="html"
                            scope="external">Designate DNSaaS services for OpenStack</xref></li>
                </ul><ul id="ul_mjp_d5p_ks">
                    <li><xref href="https://docs.hpcloud.com/api/dns/" format="html"
                            scope="external">HP Helion Public Cloud DNS API
                                Specifications</xref><p><b>Note</b>: Public Cloud API and HP Helion
                                    Openstack API details are similar.</p> <xref type="section" href="#topic19557/top"> Return to Top </xref></li>
                </ul></p>
        </section>
    </body>
</topic>
