---
layout: default-devplatform
permalink: /als/v1/client/constructor
product: devplatform
title: "HP Application Lifecycle Service (ALS) Client Constructor Virtual Machine"

---

<!--UNDER REVISION-->

# HP Helion Development Platform: HP Application Lifecycle Service (ALS) Constructor Virtual Machine

The Constructor VM is normally a short-lived virtual machine that handles the provisioning of the Application Lifecycle Service (ALS) in an HP Helion OpenStack&reg; public or private cloud. it can also function in a destructor mode to simplify the tear-down of the ALS platform-as-a-system.

Nearly all management tasks for the Constructor VM (CVM) are easily performed from the Horizon web-based management console. 
Horizon performs a call to Nova with *cloud-init* configuration data to trigger the Helion ALS PaaS construction. The OpenStack&reg; metadata service is used to communicate ALS construction status back to the Horizon UI.

There are a few features and [troubleshooting](#troubleshooting) options, however, that cannot be managed from within Horizon. For example, it currently does not support [adding Service or DEA nodes](#growthnodes) to a system that is already in place. The CVM is also self-terminating by default, but this can be [overridden](#disable) from the command line for troubleshooting to ensure that [log files](#logfile) are not lost.

1. [Launch](#launch) an instance of the Constructor Virtual Machine.
2. [Generate a key pair](#keypair).
1. Choose the appropriate boot option:
	- [Use the Horizon wizard](#consoleboot).
	- Use a [configuration file](#configfile).
	- Manual boot without a configuration file for Helion [private cloud](#privatecloud).
	- Manual boot without a configuration file for Helion [public beta](#publiccloud).

##Launch an Instance of the CVM Image {#launch}
The Constructor VM image is available from your HP Helion OpenStack&reg; account. The default username is *debian*.

1. If you don't already have a user account on the <a href="https://horizon.hpcloud.com/register" target="_blank">HP Helion Public Cloud</a>, take advantage of the <a href="http://www.hpcloud.com/cloud-credit" target="_blank">free trial offer</a> to sign up now. You will be asked to provide a phone number for verification and a credit card during registration, but there is no charge.
2. Log in to the [Horizon Console](https://horizon.hpcloud.com/) <br /> 
3. Change to the **US East Region**.<br /><img src="media/quickstartA11.png"/><br /><br />
3. Select the **Manage Services** panel and then click the **Activate Services** sub-panel.
4. In the **US East** section, click **Activate Services**. <br /><img src="media/constructor_activateServices.png"/><br /><br />
5. In the **Compute** row, use the pulldown to select **Image Management**. <br /><img src="media/constructor_imagemanagement.png"/><br /><br />
5. In the list of available images, select **Public** images.
7. Find the **Image Name** *HP Helion Development Platform CE - Application Lifecycle Service Installer A.B.C.D* where A.B.C.D is the most recent version number. Do not select any version marked as "Deprecated".
8. Click the checkbox next to the image name and then, under **Actions**, click **Launch**.

## Generate a Key Pair {#keypair}
The image does not include a password; the virtual machine is booted with an associated SSH key. 

1. Click on the **Compute** sub-panel and then click **Access & Security**.
2. Click on the **Key Pairs** tab and then click **+ Create Key Pair**.<br /><img src="media/quickstartE11.png"/></br></br>
3. Enter a name in the **Key Pair Name** field and then click **Create Key Pair**.<br /><img src="media/quickstartkeypair"/></br></br>
4. When prompted, save the *keyPairName.pem* file somewhere you can easily find it again. (If you are not automatically prompted to save the file, click the link to download it.) This file contains the RSA private key that you will need to SSH into your VM instance.

## Boot Options

### Using the Helion Console {#consoleboot}
Creating a cluster via the Horizon wizard is by far the simplest option, when possible. This method passes the configuration and environment variable values via a wizard that prompts the user to enter options.

1. The user creates a cluster using the ALS Horizon wizard.
2. Upon completion of the ALS Horizon wizard, the CVM boots.
3. The */etc/rc.local* script runs and detects the *cloud-init* file (JSON) generated by the input that was provided to the Horizon wizard.
4. The *cloud-init* JSON file is converted to *cluster.conf*, which is a ConfigFile file.
5. The assemble.py script runs using the values in *cluster.conf*
6. The CVM terminates. (Unless the termination is [overridden](#disable).)

### Boot the VM using the Configuration File {#configfile}
This method passes the configuration and environment variable values via a *cloud-init* data file created prior to booting the CVM.

1. Perform a Nova call and pass in the path to a *cloud-init* data file. 
2. The CVM boots.
3. The */etc/rc.local* script runs and detects the *cloud-init* file.
5. The *cloud-init* file is converted from JSON to ConfigFile format and renamed *cluster.conf*.
6. The *assemble.py* script runs using the values contained in *cluster.conf*
4. A Message of the Day is displayed, providing additional instructions to the user.

Here is an example of the *cloud-init* file in JSON format used for Helion ALS PaaS construction. There are three sections of key-value pairs related to ALS (PaaS), OpenStack (IaaS), and Control. The configuration file provides these values to the Constructor VM during the Nova boot process. 

<pre>
{
    "ALS": {
        "admin_email": "admin@example.com",
        "admin_org": "org1",
        "admin_password": "adminpass1",
        "cluster_title": "stack1", 
        "cluster_prefix": "s1",
        "dea_count": "1",
        "router_count": "0",
        "services": "mysql,rabbitmq",
        "services_on_core": "False",
        "upstream_proxy": "",
        "http_proxy": "",
        "https_proxy": ""
    },
    "OpenStack": {
        "auth_url": "https://region-b.geo-1.identity.hpcloudsvc.com:35357/v2.0",
        "az": "az1",
        "block_mount": "/block_storage",
        "core_size": "standard.small",
        "core_volume_size": "0",
        "dea_size": "standard.medium",
        "image_id": "d782c03d-9666-4639-a62f-53b376880120",
        "image_password": "stackato",
        "keypair_name": "keypair1",
        "network_id": "0ec616d0-872d-424b-ac27-3b5db55d7fa0",
        "region": "region-a.geo-1",
        "router_id": "ab5f7adf-e506-422f-b724-07b0010f1190",
        "router_size": "standard.medium",
        "service_size": "standard.medium",
        "service_volume_size": "0",
        "os_database_instance_id": "12345",
        "os_database_flavor_id": "1",
        "os_database_volume_size": "10",
        "tenant_id": "12345678901234", 
        "token": "HP_..."
    },
    "Control": {
        "delete_cluster": "False",
        "grow_cluster": "False",
        "delete_database": "False",
        "terminate_constructor": "True"
    }
}
</pre>

### Boot Without a Configuration File (Helion private cloud) {#privatecloud}
During the boot process the CVM will detect that a configuration file is not present. When the user logs in, the CVM will prompt the user to run a script which will create a configuration file. 

1. Create an instance of the ALS Installer and boot it manually, or perform a Nova boot of the image. Do not provide a path to a configuration file.
2. The CVM boots.
3. The */etc/rc.local* script runs and does not detect a configuration file.
4. The user logs into the CVM via SSH.
5. A message prompts the user to run *configure.py* to produce a *cluster.conf* configuration file (ConfigFile format).
6. The user has the option to manually edit the *cluster.conf* file.
7. The *assemble.py* script runs automatically and applies the values contained in the *cluster.conf* file.
8. The CVM terminates. (Unless the termination is [overridden](#disable).)

### Boot Without a Configuration File (for public beta) {#publiccloud}
This is the process used for the [Developer Quick-Start trial](/helion/devplatform/ALS-developer-trial-quick-start/). During the boot process the CVM will detect that a configuration file is not present. When the user logs in, the CVM will prompt the user to run a script which will create a configuration file specifically tailored for the public beta. 

1. Create an instance of the ALS Installer and boot it manually, or perform a Nova boot of the image without providing a config file.
2. The CVM boots.
3. During the boot process the CVM will detect that a configuration file is not present.
4. When the user logs in, the CVM will prompt the user to run the *trial_configure.py* script which will create a *cluster.conf* configuration file (ConfigFile format).
5. The *assemble.py* script runs automatically and applies the values contained in the *cluster.conf* file.
8. The CVM terminates. (Unless the termination is [overridden](#disable).)

<pre>
##############################################################################
This virtual machine was specifically built to provision an HP Helion 
Development Platform ALS cluster within your HP Helion OpenStack account.  

The VM contains all the tools necessary to get started with the HP Helion 
Development platform, but you will need to provide some configuration data.  

Please enter the command below to get started:

python ./trial_configure.py

##############################################################################
</pre>


##Creating Growth Configuration Files {#growthfiles}

Examples of options that can be added to the configuration file. The first example adds more DEA nodes to an existing cluster. The second example adds more services to the cluster.

###DEA growth configuration file example

NOTE: The *dea_count* value is the number of DEAs to be **added** in this growth mode; do not count any DEAs that already exist.

<pre>
[OpenStack]
auth_url = https://region-b.geo-1.identity.hpcloudsvc.com:35357/v2.0
username = 
password = 
tenant_id = 
region = region-b.geo-1
image_id = 
image_password = 
dea_size = standard.medium
service_size = standard.medium

[ALS]
cluster_prefix = growth
dea_count = 1
services = 

[Control]
grow_cluster = True
</pre>

###Service growth configuration file example

NOTE: The comma-separated values in the list of services contain only the services to be **added** in this growth mode. Do not list services that already exist.

<pre>
[OpenStack]
auth_url = https://region-b.geo-1.identity.hpcloudsvc.com:35357/v2.0
username = 
password = 
tenant_id = 
region = region-b.geo-1
image_id = 
image_password = 
dea_size = standard.medium
service_size = standard.medium

[ALS]
cluster_prefix = growth
dea_count = 0
services = filesystem,redis

[Control]
grow_cluster = True
</pre>

## Running the Helion ALS in the public cloud

* [Developer Trial Quick Start](http://docs.hpcloud.com/helion/devplatform/ALS-developer-trial-quick-start/)

This is an example of the ConfigParser file format options for the Quick Start Trial:

<pre>
[OpenStack]
auth_url = https://region-b.geo-1.identity.hpcloudsvc.com:35357/v2.0
username = 
password = 
tenant_id = 
region = region-b.geo-1
az = az1
keypair_name = 
network_id = 
image_id = 
image_password = 
core_size = standard.medium
router_size = standard.medium
dea_size = standard.medium
service_size = standard.medium
core_volume_size = 0
service_volume_size = 0
block_mount = /block_storage

[ALS]
cluster_title = 
cluster_prefix = 
router_count = 0
dea_count = 0
services = mysql
admin_email = admin@example.com
admin_password = 
admin_org = als
services_on_core = True
</pre>

##Troubleshooting {#troubleshooting}
<table style="text-align: left; vertical-align: top; width:650px;">
<tr style="background-color: #C8C8C8;">
<th>Failure Condition</th><th>Description</th><th>Resolution</th></tr>
<tr><td>Error message when clicking the Create Cluster button in the Horizon dashboard.</td><td>Danger: An error occurred. Please try again later.</td><td>
The Database service is installed, but the API is not responding. Try loading the Database Instances tab in Horizon. If the Database Instances tab fails to load, repair the Database Service.</td></tr>
<tr><td>Error message when clicking the final button in the Create Cluster Wizard in the Horizon UI.</td><td>Danger: An error occurred. (or similar message)</td><td>1.  Try to boot an ALS Installer image (make sure you open up port 22 in the default security group first) in the Nova Instances tab. </br></br>
2. If the image doesn't boot, the image is broken (check the size) or Nova is broken.</br></br>
3. If the image boots and says it's running, try to SSH into it.  If you can't SSH, check the instance's console log in the Horizon Instances UI.  If you see a message about "unable to contact metadata server, falling back", the Nova Metadata service is broken.</br></br>
4. If you can SSH in successfully, re-try cluster setup; the cause may be intermittent failures in Horizon/Nova.</td></tr>
<tr><td>Failure in building cluster step</td><td>Cluster stays in BUILDING state for an extremely long time, or drops to ERROR state.</br></br>OR</br></br>The ALS installer log on  the Installer VM reports 'No route to host'.</td><td>1. Assign a floating IP to the constructor instance and try SSHing to it. </br></br>
2. If you can't SSH, check the instance's console log in the Horizon Instances UI. If you see a message about "unable to contact metadata server, falling back", the Nova Metadata service is broken.</br></br>
3. Boot a couple of other installer images or Debian images in the same network and try to ssh between them.  If you get the "No route to host" error message, Neutron networking is broken.</td></tr>
</table>

### JSON option to disable self-destruction {#disable}

Set this value to **FALSE**: if you're doing the boot with json config file (nova call boot). This prevents the CVM from self-destcuting for logging and troubleshooting purposes.

<pre>
"Control": {
	"terminate_constructor": "False"
}
</pre>

### Logfile location {#logfile}

For troubleshooting, look at the constructor **assemble.py** logfile, ssh into the Constructor VM and edit the following file:

	/tmp/assemble_log.txt